<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Display All Data</title>
</head>

<body>

    <h1>Data Selfi App.</h1>
    <p>This is practice project originally made by Joyee Lee and is tought by codingtrain channel</p>
    <form action="/">
        <input type="submit" value="Back to home" />
    </form> <br>

    Sort Data Using <a href="#" id="time">Timestamp</a> || <a href="#" id="caption">Caption</a> <br>

    <table id="table">
        <tr>
            <th>Caption</th>
            <th>Longitude</th>
            <th>Latitude</th>
            <th>Timestamp</th>
            <th>Image</th>
        </tr>
    </table>


    <script>
        getData();


        const selfies = [];

        document.getElementById('time').addEventListener('click', event => {
            sortData((a, b) => b.time - a.time);
        });

        document.getElementById('caption').addEventListener('click', event => {
            sortData((a, b) => {
                // var nameA = a.name.toUpperCase();
                // var nameB = b.name.toUpperCase();
                if (b.caption > a.caption) return -1;
                else return 1;
            });
        });

        function sortData(compare) {
            for (let item of selfies) {
                item.elt.remove();
            }
            selfies.sort(compare);
            for (let item of selfies) {
                document.body.append(item.elt);
            }
        }

        async function getData() {
            const response = await fetch('/api');
            const data = await response.json();
            // console.log(data);

            for (item of data) {
                const myTable = document.querySelector('tbody');
                const tableRow = document.createElement('tr');
                const image = document.createElement('img');
                image.src = item.image64;
                image.alt = item.caption;
                tableRow.appendChild(
                    document.createElement('td')
                ).textContent = item.caption;
                tableRow.appendChild(
                    document.createElement('td')
                ).textContent = item.lon;
                tableRow.appendChild(
                    document.createElement('td')
                ).textContent = item.lat;
                const datestring = new Date(item.timestamp).toLocaleString();
                tableRow.appendChild(
                    document.createElement('td')
                ).textContent = datestring;
                tableRow.appendChild(
                    document.createElement('td')
                ).appendChild(image);

                selfies.push({ elt: tableRow, time: item.timestamp, caption: item.caption });

                myTable.appendChild(tableRow);
            }
        }
        // fetch('/api')
    </script>
</body>

</html>